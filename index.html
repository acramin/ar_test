<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Red Bull AR Experience</title>
    <link href="https://fonts.googleapis.com/css2?family=Montserrat:wght@400;500;600;700&display=swap" rel="stylesheet">
    <script src="https://cdnjs.cloudflare.com/ajax/libs/three.js/r128/three.min.js"></script>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            font-family: 'Montserrat', sans-serif;
        }
        
        body {
            background: linear-gradient(135deg, #000000 0%, #2b2b2b 100%);
            color: white;
            min-height: 100vh;
            overflow-x: hidden;
            touch-action: none;
        }
        
        .container {
            max-width: 1200px;
            margin: 0 auto;
            padding: 20px;
        }
        
        header {
            text-align: center;
            padding: 30px 0;
            position: relative;
            z-index: 100;
        }
        
        .logo {
            display: flex;
            justify-content: center;
            align-items: center;
            margin-bottom: 20px;
        }
        
        .logo img {
            height: 80px;
        }
        
        h1 {
            font-size: 2.5rem;
            margin-bottom: 10px;
            text-transform: uppercase;
            letter-spacing: 2px;
            background: linear-gradient(90deg, #ff0000 0%, #ff9900 100%);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
        }
        
        .subtitle {
            font-size: 1.2rem;
            margin-bottom: 30px;
            opacity: 0.8;
        }
        
        .ar-container {
            position: relative;
            width: 100%;
            height: 60vh;
            margin: 20px auto;
            border-radius: 20px;
            overflow: hidden;
            box-shadow: 0 10px 30px rgba(255, 0, 0, 0.3);
            background: #1a1a1a;
            display: flex;
            justify-content: center;
            align-items: center;
        }
        
        .ar-demo-content {
            text-align: center;
            z-index: 2;
        }
        
        .ar-demo-content h2 {
            font-size: 2rem;
            margin-bottom: 20px;
            color: #ff9900;
        }
        
        .ar-demo-content p {
            max-width: 80%;
            margin: 0 auto 30px;
            line-height: 1.6;
        }
        
        .instructions {
            background: rgba(255, 255, 255, 0.1);
            border-radius: 15px;
            padding: 20px;
            margin: 30px 0;
            text-align: center;
        }
        
        .instructions h2 {
            margin-bottom: 15px;
            color: #ff9900;
        }
        
        .steps {
            display: flex;
            justify-content: space-around;
            flex-wrap: wrap;
            margin-top: 20px;
        }
        
        .step {
            width: 30%;
            min-width: 250px;
            margin-bottom: 20px;
            padding: 20px;
            background: rgba(255, 153, 0, 0.1);
            border-radius: 10px;
            text-align: center;
        }
        
        .step-number {
            display: inline-block;
            width: 40px;
            height: 40px;
            line-height: 40px;
            border-radius: 50%;
            background: #ff9900;
            color: black;
            font-weight: bold;
            margin-bottom: 10px;
        }
        
        .cta {
            text-align: center;
            padding: 40px 0;
        }
        
        .cta-button {
            display: inline-block;
            padding: 15px 40px;
            background: linear-gradient(90deg, #ff0000 0%, #ff9900 100%);
            color: white;
            border: none;
            border-radius: 50px;
            font-size: 1.2rem;
            font-weight: bold;
            cursor: pointer;
            text-transform: uppercase;
            letter-spacing: 1px;
            transition: transform 0.3s, box-shadow 0.3s;
            box-shadow: 0 5px 15px rgba(255, 153, 0, 0.4);
        }
        
        .cta-button:hover {
            transform: translateY(-3px);
            box-shadow: 0 8px 20px rgba(255, 153, 0, 0.6);
        }
        
        footer {
            text-align: center;
            padding: 20px;
            margin-top: 30px;
            border-top: 1px solid rgba(255, 255, 255, 0.1);
            font-size: 0.9rem;
            opacity: 0.7;
        }
        
        /* AR Camera and Game Overlay Styles */
        #camera-container {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            z-index: 1;
            display: none;
        }
        
        #camera-video {
            position: absolute;
            width: 100%;
            height: 100%;
            object-fit: cover;
            z-index: 1;
            transform: scaleX(-1);
        }
        
        #canvas-container {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            z-index: 2;
            display: none;
        }
        
        #ui-overlay {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            z-index: 3;
            pointer-events: none;
            display: none;
            flex-direction: column;
            justify-content: space-between;
            align-items: center;
            padding: 20px;
        }
        
        #instructions {
            background: linear-gradient(135deg, rgba(255, 0, 0, 0.8), rgba(255, 153, 0, 0.8));
            padding: 15px 20px;
            border-radius: 20px;
            text-align: center;
            max-width: 80%;
            backdrop-filter: blur(5px);
            box-shadow: 0 5px 15px rgba(0, 0, 0, 0.3);
        }
        
        #score {
            background-color: rgba(0, 0, 0, 0.7);
            padding: 10px 20px;
            border-radius: 20px;
            text-align: center;
            margin-top: 15px;
            backdrop-filter: blur(5px);
        }
        
        #reticle {
            position: fixed;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            width: 40px;
            height: 40px;
            z-index: 4;
            pointer-events: none;
            display: none;
        }
        
        .reticle-circle {
            position: absolute;
            width: 100%;
            height: 100%;
            border: 2px solid rgba(255, 255, 255, 0.8);
            border-radius: 50%;
            box-shadow: 0 0 10px rgba(255, 153, 0, 0.8);
        }
        
        .reticle-dot {
            position: absolute;
            top: 50%;
            left: 50%;
            width: 4px;
            height: 4px;
            background: white;
            border-radius: 50%;
            transform: translate(-50%, -50%);
        }
        
        #congrats-popup {
            position: fixed;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%) scale(0);
            background: linear-gradient(135deg, #ff0000, #ff9900);
            padding: 30px;
            border-radius: 20px;
            text-align: center;
            z-index: 10;
            width: 80%;
            max-width: 400px;
            box-shadow: 0 10px 30px rgba(0, 0, 0, 0.5);
            transition: transform 0.5s cubic-bezier(0.175, 0.885, 0.32, 1.275);
            pointer-events: none;
        }
        
        #congrats-popup.visible {
            transform: translate(-50%, -50%) scale(1);
            pointer-events: auto;
        }
        
        #congrats-popup h2 {
            margin-bottom: 15px;
            font-size: 24px;
        }
        
        #congrats-popup p {
            margin-bottom: 20px;
            font-size: 16px;
        }
        
        #play-again {
            background-color: white;
            color: #ff0000;
            border: none;
            padding: 12px 25px;
            border-radius: 50px;
            font-size: 16px;
            font-weight: bold;
            cursor: pointer;
            transition: transform 0.2s, background-color 0.2s;
        }
        
        #play-again:active {
            transform: scale(0.95);
            background-color: #f0f0f0;
        }
        
        #loading {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: linear-gradient(135deg, #000000 0%, #2b2b2b 100%);
            display: flex;
            flex-direction: column;
            justify-content: center;
            align-items: center;
            z-index: 100;
        }
        
        .camera-switch {
            position: fixed;
            bottom: 20px;
            right: 20px;
            z-index: 4;
            background: rgba(0, 0, 0, 0.7);
            width: 50px;
            height: 50px;
            border-radius: 50%;
            display: none;
            justify-content: center;
            align-items: center;
            backdrop-filter: blur(5px);
            pointer-events: auto;
        }
        
        .camera-icon {
            font-size: 24px;
            color: white;
        }
        
        .hit-effect {
            position: fixed;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            width: 100px;
            height: 100px;
            border-radius: 50%;
            background: radial-gradient(circle, rgba(255,153,0,0.8) 0%, rgba(255,153,0,0) 70%);
            opacity: 0;
            pointer-events: none;
            z-index: 5;
        }
        
        .loader {
            width: 60px;
            height: 60px;
            border: 5px solid rgba(255, 255, 255, 0.2);
            border-radius: 50%;
            border-top: 5px solid #ff9900;
            animation: spin 1s linear infinite;
            margin-bottom: 20px;
        }
        
        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }
        
        @keyframes hitAnimation {
            0% { transform: translate(-50%, -50%) scale(0); opacity: 0.8; }
            100% { transform: translate(-50%, -50%) scale(2); opacity: 0; }
        }
        
        .permission-btn {
            background: linear-gradient(135deg, #ff0000, #ff9900);
            color: white;
            border: none;
            padding: 15px 30px;
            border-radius: 50px;
            font-size: 18px;
            font-weight: bold;
            cursor: pointer;
            margin: 10px;
            transition: transform 0.2s, opacity 0.2s;
        }
        
        .permission-btn:active {
            transform: scale(0.95);
            opacity: 0.8;
        }
        
        /* AR elements for visual design */
        .redbull-can {
            width: 40px;
            height: 100px;
            background: linear-gradient(90deg, #ff0000 0%, #ff9900 100%);
            border-radius: 5px;
            position: absolute;
        }
        
        .redbull-can:before {
            content: '';
            position: absolute;
            top: 10px;
            left: 5px;
            right: 5px;
            bottom: 10px;
            background: rgba(255, 255, 255, 0.2);
            border-radius: 3px;
        }
        
        .redbull-logo {
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            width: 30px;
            height: 30px;
            background: white;
            border-radius: 50%;
            display: flex;
            justify-content: center;
            align-items: center;
            font-weight: bold;
            color: #ff0000;
            font-size: 10px;
            text-align: center;
        }
        
        .destination {
            position: absolute;
            width: 100px;
            height: 100px;
            background: rgba(255, 153, 0, 0.3);
            border: 2px dashed #ff9900;
            border-radius: 10px;
            display: flex;
            justify-content: center;
            align-items: center;
            color: white;
            font-weight: bold;
            text-align: center;
        }
        
        /* Demo AR elements */
        .demo-can-1 {
            top: 30%;
            left: 20%;
        }
        
        .demo-can-2 {
            top: 50%;
            left: 35%;
        }
        
        .demo-can-3 {
            top: 40%;
            left: 50%;
        }
        
        .demo-can-4 {
            top: 60%;
            left: 65%;
        }
        
        .demo-destination {
            top: 45%;
            right: 15%;
        }
        
        @media (max-width: 768px) {
            h1 {
                font-size: 2rem;
            }
            
            .step {
                width: 100%;
            }
            
            .ar-container {
                height: 50vh;
            }
            
            .demo-can-1, .demo-can-2, .demo-can-3, .demo-can-4 {
                display: none;
            }
            
            .demo-destination {
                position: relative;
                top: 0;
                right: 0;
                margin: 20px auto;
            }
        }
    </style>
</head>
<body>
    <!-- Landing Page -->
    <div class="container">
        <header>
            <div class="logo">
                <img src="data:image/svg+xml;base64,PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHZpZXdCb3g9IjAgMCAyNDAgNjAiPjxwYXRoIGZpbGw9IiNmZjAwMDAiIGQ9Ik0xMDMuNCAyNC4zaC0xMHYtNi40aDEwYzIuMyAwIDQuMSAwLjQgNS40IDEuMSAxLjIgMC43IDIuMSAxLjcgMi43IDIuOSAwLjYgMS4yIDAuOSAyLjcgMC45IDQuNCAwIDEuNy0wLjMgMy4xLTAuOSA0LjItMC42IDEuMS0xLjUgMi0yLjcgMi42LTEuMiAwLjYtMi45IDEtNS4xIDFoLTMuN3YtNC44aDMuMWMwLjkgMCAxLjUtMC4yIDEuOS0wLjUgMC40LTAuMyAwLjYtMC44IDAuNi0xLjQgMC0wLjYtMC4yLTEuMS0wLjYtMS40LTAuNC0wLjMtMS0wLjUtMS45LTAuNXptMTEuMi0yLjRoNC44YzAuMS0xLjEgMC41LTEuOSAxLjItMi41IDAuNy0wLjYgMS43LTAuOSAzLTAuOXMyLjMgMC4zIDMgMC45YzAuNyAwLjYgMS4xIDEuNCAxLjIgMi41aDQuOGMtMC4yLTIuMi0xLjEtMy45LTIuNi01LTEuNi0xLTQuMS0xLjYtNy4zLTEuNi0zLjIgMC01LjcgMC41LTcuMyAxLjYtMS41IDEuMS0yLjQgMi44LTIuNiA1em0xNi4zIDIuNGgxMGMxLjcgMCAzLjEtMC4zIDQuMi0wLjkgMS4xLTAuNiAyLTEuNSAyLjYtMi42IDAuNi0xLjEgMC45LTIuNSAwLjktNC4yIDAtMS43LTAuMy0zLjEtMC45LTQuMi0wLjYtMS4xLTEuNS0yLTIuNi0yLjYtMS4xLTAuNi0yLjUtMC45LTQuMi0wLjloLTEwdjYuOHptLTQuOC0xMC4yaDE0Ljh2NC44aC0xNC44di00Ljh6bS0xMC4xIDMuNGg0LjVjMC4xLTAuOSAwLjUtMS42IDEuMi0yLjEgMC43LTAuNSAxLjctMC44IDIuOS0wLjhzMi4yIDAuMyAyLjkgMC44YzAuNyAwLjUgMS4xIDEuMiAxLjIgMi4xaDQuNWMtMC4yLTEuOC0xLTMuMi0yLjQtNC4xLTEuNC0wLjktMy42LTEuNC02LjUtMS40LTIuOSAwLTUuMSAwLjUtNi41IDEuNC0xLjQgMC45LTIuMiAyLjMtMi40IDQuMXptLTMyLjUtOS4yaDEwdjI4LjJoLTExdi0xOC40aC05LjJ2MTguNGgtMTF2LTI4LjJoMTBsMC4xIDQuMmg5LjF2LTQuMnptLTQwLjcgMjQuOGMwLTEuOS0wLjYtMy40LTEuNy00LjUtMS4xLTEuMS0yLjctMS43LTQuNy0xLjdzLTMuNiAwLjYtNC43IDEuN2MtMS4xIDEuMS0xLjcgMi42LTEuNyA0LjUgMCAxLjkgMC42IDMuNCAxLjcgNC41IDEuMSAxLjEgMi43IDEuNyA0LjcgMS43czMuNi0wLjYgNC43LTEuN2MxLjEtMS4xIDEuNy0yLjYgMS43LTQuNXptLTExLjQgMGMwLTMuMiAxLjEtNS45IDMuMi03LjkgMi4xLTIgNC45LTMgOC40LTMgMy41IDAgNi4zIDAuOSA4LjQgMi45IDIuMSAyIDMuMiA0LjcgMy4yIDggMCAzLjItMS4xIDUuOS0zLjIgNy45LTIuMSAyLTUuMSAzLTguNCAzLTMuNCAwLTYuMi0xLTguMy0zLTIuMS0yLTMuMi00LjctMy4yLTcuOXptLTQ1LjMtMTQuNmgxMHYyOC4yaC0xMHYtNC40Yy0xLjUgMi4xLTMuNSAzLjItNiAzLjItMi4zIDAtNC4yLTAuOC01LjUtMi40LTEuMy0xLjYtMi01LTIuOC0xMC4yLTAuOCA1LjItMi4yIDguNi00LjIgMTAuMi0yIDEuNi00LjUgMi40LTcuNCAyLjQtMi40IDAtNC40LTAuNy02LTIuMi0xLjYtMS41LTIuNS0zLjUtMi43LTZoLTEwYzAuMyA0LjQgMi4xIDcuOCA1LjMgMTAuMiAzLjIgMi40IDcuNCAzLjYgMTIuNCAzLjYgNS40IDAgOS42LTEuMiAxMi43LTMuNSAzLjEtMi4zIDQuNy01LjggNC43LTEwLjR2LTE0LjloLTEwem0tMjQuMSAwLjJjLTMuNSAwLTYuMyAwLjktOC40IDIuOC0yLjEgMS45LTMuMiA0LjUtMy4yIDcuOSAwIDMuMyAxLjEgNS45IDMuMiA3LjggMi4xIDEuOSA0LjkgMi45IDguNCAyLjkgMy41IDAgNi4zLTAuOSA4LjQtMi45IDIuMS0xLjkgMy4yLTQuNSAzLjItNy44IDAtMy4zLTEuMS01LjktMy4yLTcuOC0yLjEtMS45LTQuOS0yLjktOC40LTIuOXptMCA0LjZjMS45IDAgMy40IDAuNiA0LjQgMS43IDAuOSAxLjIgMS40IDIuOCAxLjQgNC45IDAgMi4xLTAuNSAzLjctMS40IDQuOS0wLjkgMS4yLTIuNSAxLjctNC40IDEuNy0xLjkgMC0zLjQtMC42LTQuNC0xLjctMC45LTEuMi0xLjQtMi44LTEuNC00LjkgMC0yLjEgMC41LTMuNyAxLjQtNC45IDEtMS4xIDIuNS0xLjcgNC40LTEuN3oiLz48L3N2Zz4=" alt="Red Bull Logo">
            </div>
            <h1>CaÃ§a a latinha</h1>
            <p class="subtitle">Procure e encontre a latinha escondida!</p>
        </header>

        <div class="ar-container">
            <div class="ar-demo-content">
                <h2>AR Experience Demo</h2>
                <p>In the full experience, you would see a camera view with AR elements here</p>
            </div>
            
            <!-- Visual demo elements -->
            <div class="redbull-can demo-can-1">
                <div class="redbull-logo">RB</div>
            </div>
            <div class="redbull-can demo-can-2">
                <div class="redbull-logo">RB</div>
            </div>
            <div class="redbull-can demo-can-3">
                <div class="redbull-logo">RB</div>
            </div>
            <div class="redbull-can demo-can-4">
                <div class="redbull-logo">RB</div>
            </div>
            <div class="destination demo-destination">
                Red Bull Box Here!
            </div>
        </div>

        <div class="instructions">
            <h2>Como funciona</h2>
            <p>Apontar a cÃ¢mera do seu celular ao seu redor para descobrir a trilha AR de latinhas Red Bull que leva Ã  localizaÃ§Ã£o da verdadeira caixa Red Bull.</p>

            <div class="steps">
                <div class="step">
                    <div class="step-number">1</div>
                    <h3>Iniciar ExperiÃªncia AR</h3>
                    <p>Toque no botÃ£o abaixo para ativar a experiÃªncia da cÃ¢mera AR</p>
                </div>
                <div class="step">
                    <div class="step-number">2</div>
                    <h3>Seguir a Trilha</h3>
                    <p>Procure a latinha virtual da Red Bull em seu ambiente</p>
                </div>
                <div class="step">
                    <div class="step-number">3</div>
                    <h3>Encontre sua recompensa</h3>
                    <p>Coleta a latinha para receber a dica da onde estÃ¡ a latinha real!</p>
                </div>
            </div>
        </div>

        <div class="cta">
            <button class="cta-button" onclick="startARExperience()">Start AR Experience</button>
        </div>

        <footer>
            <p>Experiencia criada por Metaverso Maua & Red Bull Marketing</p>
            <p>Â© 2024 - All rights reserved</p>
        </footer>
    </div>

    <!-- AR Game Elements (Hidden initially) -->
    <div id="camera-container">
        <video id="camera-video" autoplay playsinline></video>
    </div>
    
    <div id="canvas-container"></div>
    
    <div id="ui-overlay">
        <div>
            <div id="instructions">
                <h2>Encontre a latinha Red Bull!</h2>
                <p>Movimente seu celular ao redor e toque na latinha quando encontrÃ¡-la</p>
            </div>
            <div id="score">
                Encontradas: <span id="found-count">0</span> latinhas
            </div>
        </div>
    </div>
    
    <div id="reticle">
        <div class="reticle-circle"></div>
        <div class="reticle-dot"></div>
    </div>
    
    <div id="congrats-popup">
        <h2>Congratulations! ðŸŽ‰</h2>
        <p>You found the floating Red Bull can!</p>
        <button id="play-again">Play Again</button>
    </div>
    
    <div id="loading">
        <div class="loader"></div>
        <p>Starting camera...</p>
        <p style="margin-top: 20px; font-size: 14px; opacity: 0.7;">Allowing camera access for AR experience</p>
    </div>

    <div class="camera-switch">
        <div class="camera-icon">ðŸ“·</div>
    </div>

    <script>
        // Main application variables
        let video, renderer, scene, camera, can;
        let alpha = 0, beta = 0, gamma = 0;
        let canPosition = { x: 0, y: 0, z: -15 };
        let foundCan = false;
        let currentFacingMode = 'environment';
        let foundCount = 0;
        let raycaster, mouse;
        let reticlePulseInterval;
        let gameStarted = false;
        let arMode = false;

        // Function to start AR experience (called from landing page button)
        function startARExperience() {
            arMode = true;
            
            // Hide landing page elements
            document.querySelector('.container').style.display = 'none';
            
            // Show loading screen
            document.getElementById('loading').style.display = 'flex';
            
            // Initialize AR
            init();
            startCamera();
        }

        // Initialize the application
        function init() {
            // Set up Three.js
            setupThreeJS();
            
            // Set up device orientation
            setupDeviceOrientation();
            
            // Set up event listeners
            document.getElementById('play-again').addEventListener('click', resetGame);
            document.querySelector('.camera-switch').addEventListener('click', switchCamera);
            
            // Set up raycaster for tap detection
            raycaster = new THREE.Raycaster();
            mouse = new THREE.Vector2();
            
            // Add click/touch event listener
            renderer.domElement.addEventListener('click', onCanvasTap, false);
            renderer.domElement.addEventListener('touchstart', onCanvasTap, { passive: false });
            
            // Randomize can position
            randomizeCanPosition();
            
            // Start the render loop
            animate();
            
            // Start reticle pulsing animation
            startReticlePulse();
        }

        // Start the game automatically when camera loads
        function startGame() {
            gameStarted = true;
            
            // Hide loading screen
            document.getElementById('loading').style.display = 'none';
            
            // Show AR elements
            document.getElementById('camera-container').style.display = 'block';
            document.getElementById('canvas-container').style.display = 'block';
            document.getElementById('ui-overlay').style.display = 'flex';
            document.getElementById('reticle').style.display = 'block';
            document.querySelector('.camera-switch').style.display = 'flex';
        }

        // Set up Three.js environment
        function setupThreeJS() {
            // Create scene
            scene = new THREE.Scene();
            
            // Create camera with wider field of view for distance
            camera = new THREE.PerspectiveCamera(70, window.innerWidth / window.innerHeight, 0.1, 1000);
            camera.position.z = 5;
            
            // Create renderer
            renderer = new THREE.WebGLRenderer({ alpha: true, antialias: true });
            renderer.setSize(window.innerWidth, window.innerHeight);
            renderer.setPixelRatio(window.devicePixelRatio);
            document.getElementById('canvas-container').appendChild(renderer.domElement);
            
            // Create the can
            createCan();
            
            // Add some ambient light
            const ambientLight = new THREE.AmbientLight(0xffffff, 0.6);
            scene.add(ambientLight);
            
            // Add directional light
            const directionalLight = new THREE.DirectionalLight(0xffffff, 0.8);
            directionalLight.position.set(1, 1, 1);
            scene.add(directionalLight);
            
            // Add a second light for better visibility
            const directionalLight2 = new THREE.DirectionalLight(0xffffff, 0.4);
            directionalLight2.position.set(-1, -1, -1);
            scene.add(directionalLight2);
        }

        // Create a 3D can model
        function createCan() {
            const group = new THREE.Group();
            
            // Can body (cylinder)
            const geometry = new THREE.CylinderGeometry(0.5, 0.5, 1.2, 32);
            const material = new THREE.MeshPhongMaterial({ 
                color: 0xff3333,
                shininess: 80,
                specular: 0xeeeeee
            });
            const body = new THREE.Mesh(geometry, material);
            group.add(body);
            
            // Can top
            const topGeometry = new THREE.CylinderGeometry(0.45, 0.45, 0.05, 32);
            const topMaterial = new THREE.MeshPhongMaterial({ color: 0xcccccc, shininess: 100 });
            const top = new THREE.Mesh(topGeometry, topMaterial);
            top.position.y = 0.625;
            group.add(top);
            
            // Can rim
            const rimGeometry = new THREE.TorusGeometry(0.45, 0.02, 16, 32);
            const rimMaterial = new THREE.MeshPhongMaterial({ color: 0xeeeeee, shininess: 100 });
            const rim = new THREE.Mesh(rimGeometry, rimMaterial);
            rim.position.y = 0.625;
            rim.rotation.x = Math.PI / 2;
            group.add(rim);
            
            // Can label
            const labelGeometry = new THREE.CylinderGeometry(0.5, 0.5, 0.8, 32);
            const labelMaterial = new THREE.MeshPhongMaterial({ 
                color: 0x3366ff,
                shininess: 60
            });
            const label = new THREE.Mesh(labelGeometry, labelMaterial);
            label.position.y = 0.1;
            label.scale.set(1.01, 1, 1.01);
            group.add(label);
            
            // Add invisible collision sphere for easier tapping
            const collisionGeometry = new THREE.SphereGeometry(1, 16, 16);
            const collisionMaterial = new THREE.MeshBasicMaterial({ 
                transparent: true, 
                opacity: 0,
                visible: false
            });
            const collisionMesh = new THREE.Mesh(collisionGeometry, collisionMaterial);
            collisionMesh.userData.isCanCollision = true;
            group.add(collisionMesh);
            
            // Add floating animation
            group.userData = { floatTime: Math.random() * 100 };
            
            scene.add(group);
            can = group;
            
            // Position the can further away
            can.position.set(canPosition.x, canPosition.y, canPosition.z);
        }

        // Set up device orientation tracking
        function setupDeviceOrientation() {
            if (window.DeviceOrientationEvent) {
                window.addEventListener('deviceorientation', (event) => {
                    // Adjust these values based on device orientation
                    alpha = event.alpha ? THREE.MathUtils.degToRad(event.alpha) : 0;
                    beta = event.beta ? THREE.MathUtils.degToRad(event.beta) : 0;
                    gamma = event.gamma ? THREE.MathUtils.degToRad(event.gamma) : 0;
                });
            } else {
                console.log('Device orientation not supported on this device. The experience will be limited.');
            }
        }

        // Start the device camera
        function startCamera() {
            video = document.getElementById('camera-video');
            
            // Request camera access with environment (back) camera
            const constraints = {
                video: { 
                    facingMode: currentFacingMode,
                    width: { ideal: 1280 },
                    height: { ideal: 720 }
                }
            };
            
            navigator.mediaDevices.getUserMedia(constraints)
                .then((stream) => {
                    video.srcObject = stream;
                    video.play();
                    
                    // Start the game automatically
                    startGame();
                })
                .catch((error) => {
                    console.error('Camera error:', error);
                    
                    // Show error message in loading screen
                    document.getElementById('loading').innerHTML = `
                        <div class="loader"></div>
                        <p>Error accessing camera</p>
                        <button onclick="startCamera()" class="permission-btn">Try Again</button>
                        <p style="margin-top: 20px; font-size: 14px; opacity: 0.7;">
                            Please make sure you allowed camera access
                        </p>
                    `;
                    
                    // If back camera fails, try front camera
                    if (currentFacingMode === 'environment') {
                        currentFacingMode = 'user';
                        video.style.transform = 'scaleX(1)';
                        setTimeout(() => startCamera(), 1000);
                    }
                });
        }

        // Switch between front and back camera
        function switchCamera() {
            currentFacingMode = currentFacingMode === 'environment' ? 'user' : 'environment';
            
            // Update video flip for front/back camera
            video.style.transform = currentFacingMode === 'environment' ? 'scaleX(-1)' : 'scaleX(1)';
            
            // Restart camera with new facing mode
            if (video.srcObject) {
                const tracks = video.srcObject.getTracks();
                tracks.forEach(track => track.stop());
            }
            
            startCamera();
        }

        // Handle tap on canvas
        function onCanvasTap(event) {
            // Only allow tapping if game has started
            if (!gameStarted || foundCan) return;
            
            // Prevent default for touch events to avoid scrolling
            if (event.type === 'touchstart') {
                event.preventDefault();
            }
            
            // Calculate mouse/touch position in normalized device coordinates
            const rect = renderer.domElement.getBoundingClientRect();
            
            if (event.type === 'touchstart') {
                mouse.x = ((event.touches[0].clientX - rect.left) / rect.width) * 2 - 1;
                mouse.y = -((event.touches[0].clientY - rect.top) / rect.height) * 2 + 1;
            } else {
                mouse.x = ((event.clientX - rect.left) / rect.width) * 2 - 1;
                mouse.y = -((event.clientY - rect.top) / rect.height) * 2 + 1;
            }
            
            // Update the picking ray with the camera and mouse position
            raycaster.setFromCamera(mouse, camera);
            
            // Calculate objects intersecting the picking ray - use recursive to get children
            const intersects = raycaster.intersectObjects(scene.children, true);
            
            // Check if we hit any part of the can group
            let hitCan = false;
            for (let i = 0; i < intersects.length; i++) {
                // Check if the intersected object is part of the can group
                if (intersects[i].object.parent === can || intersects[i].object === can) {
                    hitCan = true;
                    break;
                }
            }
            
            if (hitCan) {
                foundCan = true;
                foundCount++;
                document.getElementById('found-count').textContent = foundCount;
                
                // Show hit effect
                showHitEffect();
                
                // Add visual feedback to the can
                can.scale.set(1.2, 1.2, 1.2);
                setTimeout(() => {
                    if (can) can.scale.set(1, 1, 1);
                }, 200);
                
                // Show congratulations after a short delay
                setTimeout(() => {
                    document.getElementById('congrats-popup').classList.add('visible');
                }, 800);
            }
        }

        // Show hit effect animation
        function showHitEffect() {
            const effect = document.createElement('div');
            effect.className = 'hit-effect';
            document.body.appendChild(effect);
            
            // Animate the effect
            effect.style.animation = 'hitAnimation 0.8s forwards';
            
            // Remove after animation completes
            setTimeout(() => {
                document.body.removeChild(effect);
            }, 800);
        }

        // Start reticle pulsing animation
        function startReticlePulse() {
            const reticle = document.getElementById('reticle');
            let scale = 1;
            let growing = true;
            
            reticlePulseInterval = setInterval(() => {
                if (growing) {
                    scale += 0.01;
                    if (scale >= 1.1) growing = false;
                } else {
                    scale -= 0.01;
                    if (scale <= 0.9) growing = true;
                }
                
                reticle.style.transform = `translate(-50%, -50%) scale(${scale})`;
            }, 50);
        }

        // Randomize can position for replayability
        function randomizeCanPosition() {
            // Place can randomly around the user (but not directly in front)
            const angle = Math.random() * Math.PI * 2;
            const distance = 12 + Math.random() * 5;
            
            canPosition.x = Math.cos(angle) * distance;
            canPosition.y = 1.5 + Math.random() * 2;
            canPosition.z = Math.sin(angle) * distance;
            
            if (can) {
                can.position.set(canPosition.x, canPosition.y, canPosition.z);
            }
        }

        // Reset the game for another round
        function resetGame() {
            foundCan = false;
            document.getElementById('congrats-popup').classList.remove('visible');
            randomizeCanPosition();
        }

        // Animation loop
        function animate() {
            requestAnimationFrame(animate);
            
            // Apply device orientation to camera
            if (camera) {
                camera.rotation.set(beta, alpha, gamma, 'YXZ');
            }
            
            // Animate the can (floating effect) - only if game has started
            if (can && !foundCan && gameStarted) {
                can.userData.floatTime += 0.01;
                can.position.y = canPosition.y + Math.sin(can.userData.floatTime) * 0.1;
                can.rotation.y += 0.01;
                can.visible = true;
            } else if (can && !gameStarted) {
                // Hide can before game starts
                can.visible = false;
            }
            
            // Render the scene
            if (renderer && scene && camera && arMode) {
                renderer.render(scene, camera);
            }
        }

        // Handle window resize
        window.addEventListener('resize', () => {
            if (camera) {
                camera.aspect = window.innerWidth / window.innerHeight;
                camera.updateProjectionMatrix();
            }
            if (renderer) {
                renderer.setSize(window.innerWidth, window.innerHeight);
            }
        });
    </script>
</body>
</html>